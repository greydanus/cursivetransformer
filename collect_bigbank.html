<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handwriting Stroke Capture with Automatic Word Prompts</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        button { cursor: pointer; }
        input[type="range"] { width: 100%; }
        canvas { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const SAMPLING_INTERVAL = 2;

        const Button = ({ onClick, children }) => (
            <button
                onClick={onClick}
                style={{
                    padding: '8px 16px',
                    backgroundColor: '#2D3748',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px',
                    marginRight: '8px'
                }}
            >
                {children}
            </button>
        );

        const Input = ({ type, accept, onChange, value, placeholder, style, min, max, id }) => (
            <input
                type={type}
                accept={accept}
                onChange={onChange}
                value={value}
                placeholder={placeholder}
                style={{ ...style, padding: '4px', marginBottom: '8px' }}
                min={min}
                max={max}
                id={id}
            />
        );

        const Textarea = ({ value, readOnly, style, placeholder }) => (
            <textarea
                value={value}
                readOnly={readOnly}
                style={{ ...style, padding: '4px', width: '100%', height: '200px' }}
                placeholder={placeholder}
            />
        );

        const Label = ({ htmlFor, children }) => (
            <label htmlFor={htmlFor} style={{ display: 'block', marginBottom: '4px' }}>
                {children}
            </label>
        );

        const Slider = ({ id, min, max, step, value, onChange }) => (
            <input
                id={id}
                type="range"
                min={min}
                max={max}
                step={step}
                value={value}
                onChange={onChange}
                style={{ width: '100%' }}
            />
        );

        const ErrorMessage = ({ message }) => (
            <div style={{ backgroundColor: '#FEE2E2', border: '1px solid #F87171', color: '#B91C1C', padding: '8px', borderRadius: '4px', marginBottom: '16px' }}>
                <span>{message}</span>
            </div>
        );

        const HandwritingStrokeCapture = () => {
            const [strokes, setStrokes] = React.useState([]);
            const [currentStroke, setCurrentStroke] = React.useState([]);
            const [backgroundImage, setBackgroundImage] = React.useState(null);
            const [imagePosition, setImagePosition] = React.useState({ x: 0, y: 0 });
            const [imageScale, setImageScale] = React.useState(1);
            const [isDrawing, setIsDrawing] = React.useState(false);
            const [exportedData, setExportedData] = React.useState('');
            const [author, setAuthor] = React.useState('');
            const [asciiSequence, setAsciiSequence] = React.useState('');
            const [errorMessage, setErrorMessage] = React.useState('');
            const [dataset, setDataset] = React.useState([]);
            const [wordBank, setWordBank] = React.useState([]);
            const [currentPrompt, setCurrentPrompt] = React.useState('');
            const [wordCount, setWordCount] = React.useState(1);
            const [samplingMode, setSamplingMode] = React.useState('random');
            const [startIndex, setStartIndex] = React.useState(0);
            const [currentIndex, setCurrentIndex] = React.useState(0);
            const [displayIndex, setDisplayIndex] = React.useState(0);

            const canvasRef = React.useRef(null);
            const lastPointRef = React.useRef(null);
            const lastSampledPointRef = React.useRef(null);

            const drawStrokes = React.useCallback(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (backgroundImage) {
                    ctx.save();
                    ctx.translate(imagePosition.x, imagePosition.y);
                    ctx.scale(imageScale, imageScale);
                    ctx.drawImage(backgroundImage, 0, 0);
                    ctx.restore();
                }

                ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(0, canvas.height / 3);
                ctx.lineTo(canvas.width, canvas.height / 3);
                ctx.moveTo(0, 2 * canvas.height / 3);
                ctx.lineTo(canvas.width, 2 * canvas.height / 3);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.strokeStyle = '#2F4F4F';
                ctx.lineWidth = 2;
                strokes.forEach(stroke => {
                    if (stroke.length > 0) {
                        ctx.beginPath();
                        ctx.moveTo(stroke[0][0], stroke[0][1]);
                        stroke.forEach(point => {
                            if (point[2] === 1) {
                                ctx.lineTo(point[0], point[1]);
                            } else {
                                ctx.moveTo(point[0], point[1]);
                            }
                        });
                        ctx.stroke();
                    }
                });

                if (currentStroke.length > 0) {
                    ctx.beginPath();
                    ctx.moveTo(currentStroke[0][0], currentStroke[0][1]);
                    currentStroke.forEach(point => {
                        if (point[2] === 1) {
                            ctx.lineTo(point[0], point[1]);
                        } else {
                            ctx.moveTo(point[0], point[1]);
                        }
                    });
                    ctx.stroke();
                }
            }, [strokes, currentStroke, backgroundImage, imagePosition, imageScale]);

            React.useEffect(() => {
                drawStrokes();
            }, [drawStrokes]);

            const startDrawing = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                setCurrentStroke([[x, y, 1]]);
                lastPointRef.current = [x, y];
                lastSampledPointRef.current = [x, y];
                setIsDrawing(true);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                ctx.strokeStyle = '#2F4F4F';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(lastPointRef.current[0], lastPointRef.current[1]);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                const dx = x - lastSampledPointRef.current[0];
                const dy = y - lastSampledPointRef.current[1];
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance >= SAMPLING_INTERVAL) {
                    setCurrentStroke(prev => [...prev, [x, y, 1]]);
                    lastSampledPointRef.current = [x, y];
                }
                
                lastPointRef.current = [x, y];
            };

            const endDrawing = () => {
                if (currentStroke.length > 0) {
                    setStrokes(prev => [...prev, [...currentStroke, [currentStroke[currentStroke.length - 1][0], currentStroke[currentStroke.length - 1][1], 0]]]);
                    setCurrentStroke([]);
                }
                setIsDrawing(false);
                lastPointRef.current = null;
                lastSampledPointRef.current = null;
            };

            const generateEntry = () => {
                if (!author.trim()) {
                    setErrorMessage("Please enter an author name.");
                    return null;
                }
                if (!asciiSequence.trim()) {
                    setErrorMessage("Please enter an ASCII sequence.");
                    return null;
                }
                if (strokes.length === 0) {
                    setErrorMessage("Please draw at least one stroke before adding to dataset.");
                    return null;
                }

                let allPoints = strokes.flat();
                const canvas = canvasRef.current;
                const aspectRatio = canvas.width / canvas.height;
                const normalizedPoints = allPoints.map(point => [
                    parseFloat((point[0] / canvas.width).toFixed(4)),
                    parseFloat((point[1] / canvas.height).toFixed(4)),
                    point[2]
                ]);
                
                return {
                    metadata: {author: author.trim(), asciiSequence: asciiSequence.trim(), pointCount: allPoints.length, strokeCount: strokes.length, aspectRatio},
                    points: normalizedPoints
                };
            };

            const addToDataset = () => {
                const entry = generateEntry();
                if (entry) {
                    setDataset(prev => [...prev, entry]);
                    setStrokes([]);
                    setAsciiSequence('');
                    setErrorMessage('');
                    drawStrokes();
                    return true; // Entry successfully added
                }
                return false; // Entry not added due to error
            };

            const exportDataset = () => {
                if (dataset.length === 0) {
                    setErrorMessage("The dataset is empty. Add some entries before exporting.");
                    return;
                }
                const jsonString = JSON.stringify(dataset);
                setExportedData(jsonString);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            setBackgroundImage(img);
                            setImagePosition({ x: 0, y: 0 });
                            setImageScale(1);
                            setAsciiSequence(''); // Clear ASCII box when an image is uploaded
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleImageMove = (direction) => {
                const step = 10;
                setImagePosition(prev => {
                    switch (direction) {
                        case 'up': return { ...prev, y: prev.y - step };
                        case 'down': return { ...prev, y: prev.y + step };
                        case 'left': return { ...prev, x: prev.x - step };
                        case 'right': return { ...prev, x: prev.x + step };
                        default: return prev;
                    }
                });
            };

            const clearAll = () => {
                setStrokes([]);
                setCurrentStroke([]);
                setErrorMessage('');
                setBackgroundImage(null); // Clear the uploaded image
                setImagePosition({ x: 0, y: 0 }); // Reset image position
                setImageScale(1); // Reset image scale
                if (samplingMode === 'random') {
                    generatePrompt();
                }
                drawStrokes();
            };

            const undo = () => {
                setStrokes(prev => prev.slice(0, -1));
            };

            const loadWordBank = () => {

                const words = ["hlin", "Ikotehr", "aszed\"", "42", "cyz)", "rhne", "Kmxqngyo?", "3'11", "mdyshaiv", "61", "oteiwpt", "RSATSRKN", "hxpm", "Qaps", "VNAERL?", "uxae", "tlar,", "nkzwkk", "fru", "qhbiif?", "626'6", "ahrh'?", "lafpxp!", "854,", "mws", "6!", "Joakn", "IVSN", "XKGVOSHGH!", "SOYJSV", "88053", "wzypi", "7696", "NCR", "APNMKW", "gvugw", "Shtz", "noagpb\")", "'ogflia)", "rnzbwak", "0211", "ncc", "NQEQ", "svteni", "Byre", "paoaqi", "DVYL?", "388", "\"BMSAOP", "ivoom,", "suh", "98", "MPRAJGV", "61582.", ".735", "gjdh", "\"Qnkrh", "sedk", "Fciw", "(ambd", "tolkqb?", "rymrtd", "jlshkfkh)", "hhehdzv)", "Smtidns\"", "712)", "727?", "ikna)!", "2510.", "uatiro", "Fnbdxpng", "pusqsgzg", "Aombgi", "118.1\"", "IKSX", ".8)", "2906", "sjped", ".20", "oihgu),", "VDANXOXL", "hvgw", "(UNBNTI", "'Qot", "uunrn", "hjm,", "xubd", "LBGRATZ", "pnqty", "lyji", "gizo", "khmzuduk", "oowtt", "jdpysqc", "EZTQR", "wtgss", "UNGOQUNZF", "2770'", "TSFUXKTPA'", "006", "8.", "43326", "mchsebad", "18993'", "3955", "gnthazrmvh", "OYDKKUVI)", "HJMNZ", "fuvxr!", "\"Nrip", "xbhv", "Dmdmfjwifw.", "8.8", "11353", "\"iat", "hdbhxst,", "peye", "81679", "TOLAPYPI", "83205", "Hovgqq", "nmode", "Jorobzjwan", "ueeepk.", "ocil", "XLE", "CEE.", "yzkuey", "SQBMXXH.", "EEIWD", "(3596", "Tenvbcr", "YHIH", "Wuhfxh,", "Tvvmt,", "Zsnnsc?", "(86238", "IGD?", "loix", "eusdl", "MSGSCP)", "ivhl", "NCQJOY", "t'hw!", "kuyblcn", "mkryufrn", "hix", "inne", "qpln", "xbyaotehp", "Adyrc", "19.4", "4.?", "Wjfu", "EEHHN", "Swg", "31437", "Wjqacfnr,", "bvzxv", "Agfdato", "HFAI", "lyq", ".99854", "uhreqkv", "2", "zohe", "(xovepx", "ETWFZR", "Tspx", "97.699", "CCWNSFTM,", "YRNIEV\"", "uhfkt", "rdy", "PUWBA)", "19", "(kmsxir", "axo,", "dmie", "SXLL", "(NVKET", "60858", "MDES", "Fqu", "LFEE", "soyqbxsf!", "kypjschb", "5.", "qikrnbt", "84", "4", "dodtjumon!", "eapzxppxf", "4", "72'", "cefvwf", "hrcmtwzv", "(IGH\"", "hchyxgq", "mokt,", "(Wtdtnticrx", "FROSUJOII", "knzn", "Tsbdidf", "719.11", "Vhclrgp", "pyt)", "njesa", "gzsohhocz", "uln?", "tgljtrrrh.", "pnhh.", "9", "(999", "osqnsevei", "dixkeb", "atgsua", "93563.", "nnk", "kpym", "cbrvxpdve", ".2.", "(02", "Cntr'", "1", "asmmgt", "nphonaf", "bwvfgxr", "Ncstvptk", "Syqrar", "(rvdjj", "DBFZ", "iwbnfh", "dnpn", "isdaeejrnf", "Eihazpy", "603.5", "npkhyk", "amaym", "HVWRK", "Tinwf", "05", "Tnskv", "78,", "fesubz", "syxpy.", "xob", "(1", "JOWR)", "tqw\"", "'SHIEUE", "288", "\"ktlvhdep)?", "94324", "Zobl", "6", "30.", "052", "Sarixgi", "18207", "ssvmq", "Worl", "xqqi", "fukyb", "OPCZMC)", "Mrblgc", "DRLJD", "ctia,", "RHGTIW\"", ".62968", "gcc", "nxturuvo.", "Tkjvkrtf", "suet", "NARRX", "fpsjbkfmis", "zahtde!", "ardd", "24869,", "\"itp", "xlgxwba", "Twhnhz", "vw'stfws.", "per", "YVIOXTM", "lvihfcd?", "vqffdtr", "Xvvtwyjnw", "qvdot", "MKE!", "3.9", "OBWGQAIT!", "4787", "5296", "CRTV", "UITINP", "CNRSFHN", "Esfqgua'", "Gmhdb", "\"253!", "pek'p", "054", "y'tzxit,", "0.2093", "Ydxh", "imrgh)", "rsubjaf", "uybaobti\"", "Yomaax?", "jofyhsr", "41106.\"", "Rbit", "ries'xnhd)", "odulfebeg", "\"39246", "JOTF", "194.3", "Xpht", "WUWSU", "bzung", "cimfop?", "Rsxm", "MRNRVN", "ibmi", "2\"", "krtjekp", "suvyg", "40", "caej", "SBLL.", "sart'ibuiv", "4249", "DAQWEMKO", "Fcrj", "aphqny.", "43845\"", "(ykka.", "PAOSK)", "ixtzm)", "(ECJBQM", "gq'dec", "GKATQCXU", "syghyxn.", "Gsxtgtyh", "Yh'yii", "95.077)", "CPOAB)", "JXGT", "69", "Uxoaxen,", "ELYTSLE!", "zbho,", "'mozx", "qjm.", "sfzbe!", "euavysrgs,", "27929.", "rcxewvoo)", "uytt", "ltiistuh", "goho", "Sdsswa", "naf\"", "asct", "Qyvf", "22'54,", "VRBABAE)", "ctif", "TGOZWDV", "Rjkhk", "kdhk", "97", "10", "'ridhoin,", "986", "69148", "NRJI)", "\"VSBVEYUH", ".17)?", "xoxtmwo,", "1135", "201.", "vrt", "EALO", "jpsz!", "Qhbwpnuo", "Osy", "JEANI", "inz", "AEISNC", "412.", "FYC", "9", "33'", "ksgeoc", "374", "9730", "brscttpw", "'HZSU,", "1898!", "5", "\"aiknb", "rhwwont", "zcbfn", "0.08", "Trpf", "3", "1", "GHZCOV", "Xrtqx", "pmnkaa", "2", "Rvo", "830", "(75", "xsxj)", "ARSMJ", "qfvwek\"", "xgnnmxx", "32.99", "JWDTDBKYLI)!", "MORS", "9074", "4.4!", "Trvptbehm", "oij", "ojlaren", "eave", "fykxffo,", "nlrebj", "IFFUJCASH", "905", "3561", "40416", "ofgr)", "17", "toidaokbo", "(ofd", "44.", "po'x,", "CCNOCBXB", ".82", "ITOY", "dnfya", "93174", "wpyzqfnr", "Izrl", "XUZN)", "3598\"", "1872.", "hmtn", "hnyn", "idni", "aqpbef", "'IBURMB", "zsor", "5", "ati", "(9234,", ".38", "afsc", "sdedeg.", "43.59", "(Xovgo", "YTX'F", "nmtghoeeo),", "ORAK", "xngyxi", "Owvbrqd", "akog", "fkqjzbcqp", "IDSZ)", "ZQOI", "nhqogt\",", "zbrn", "ghiazsc", "\"1", "ampao", "ijgq", "408", "PAZL", "Rxyw", "qaqyj?", "jyutsavo.", "51025", "kakesr", "ibha", "jakm", "idqa,", "rnxygjsha", "81", "4", "(268", "10!", "saai", "acufs", "awpz", "AIEPBRN)", "eyaim", "60)!", "78190", "cmttwr", "0", "bnqfm", "Gozh", "9670", "l'wvd", "OHBZREO", "btcknm", ".7", "1", "Hbywo", "rhdo", ".09419", "xvov", "9208", "EIJGC?", "Tppoxo?", "bqn", "\"Ehezeg", "SENC", "dvgfepoq", "nnyun", "PWIF?", "ixaxhp", "EFFLIRT.", "rrte", "AOE", "(XAUSBRGMC,", "Rnv", "BXYILSA!", "mnnu", "Tlfopth", "6\"", "5", "ddxos", "4564", "wuovi", "355", "POOETFSBOT", "hio", "ofxbodsr.", ".08", "ETREOQ", "vta", "07114", "01.", "\"Hovh)?", "276", "etdndb!", "9", "qpxj", "chtay", "5", "TIYLCAYBNE!", "3439!", "qfozgo?", "wgutjkaww", "Ieott", "hash", "95.)", "jxox,", "xshdnvkqb\"", ".6690", "xialrm", "PEOI", "AYVNQ", "(lnzxph", "Hgnvzap!", "44645", "557", "Stunwsf", "Tjro", "Uaydl", "(Eegt", "recsooomt,", "OUAIXI", "(wesoz", "IZWLWN", "fsnsluf", "UXIUED!", "jeeyb'", "(xfzoigx", "udtvs", "tay", "50", "3.9", "JOA", "tsrs'", "uvgukjg\"!", "('HWTDXRWY,", "egio", "AFNI", "HRSLZG", "anwlkc", "83305", "hffmoz", "174!", "xddovdz", "17", "vfoew", "55541", "yirsl", "110", "Kmtia", "XDITT", "naiklzzq", "\"SZPR", "HRY", "VTAYZAOV", "nobizf'", "WRTHFEMB", "92820)", "ztco", "tng)", "\"qythc.", "dzj", "doyrwe", "829", "101)", "my'astnhuez", "MWIUJVC", "42?", "7.94", "8\")", "HVYR", "ttesjkjds", "Tshfmr!", "Cweshhp?", "Mtvfhjbhzm", "hrjupwiv", "9.2838", "RXQ", "tucgwb", "Trcjlp)", "mwws,", "2", "Cbzx", "uzotzm", "zoumamrpt", "SNCJ", "ismn", "uip", "Hvkmx", "HFUMYEI", "wnnw", "0.63", "folmhkeh", "esk", "YAAKTQ", "kizbh", "inbt!", "rcmgrfkz", "dcepit", "4", "rjdn", "(71238", "tbshmmn", "prvqahd", "cbwex", "ieehvsdg\"", "SXZH", "YGTPZ\"", "dhlw", "pcilv", "72584", "huw", "nnqa'ecobzr)", "tykerecdoy", "qchhr", "(bckrd", "puna", "GHQJBAGJAX", "6046", "nvi", "8816.2", "(6", "gxsniu!", "7068", "0646", "215", "UHAFVH", "iosj", "5184", "bljhlg'rn", "uvopsg),", "Eogcebsg", "fibq", "FNAWXCB", "fhtme", "yuafrned", "zoo", "cypne", "IFQS", "9646?", "lbhretf!", "Phkgmdx", "upoo", "UTKKBBHW", "EDOI.", "rpvewb!", "\"7779!", "YVSPYFOEA", "nfhc", "16286)", "VPZNMOOAB", "dxrnio", "112\"", "rzfhloejq", "YAUT", "KXAHHROD", "sasz", "(swpgk", "(ngxgseg", "peeupsl?", "6", "QHIOS", "23463", "eck", "Xapii", "aukhfxq", "DSCDWVEIAB", "JDHDIOIA,", "01377..", "akt?", "jmkyuzt", "Vvrcidi,", "cexp)", "7.", "Ucebb", "54720", "(Laglruzgli", "33011", "\"VVHMYNYRE", "Oqhrtve", "ZTVU", "lsj", "ngrsdj", "59881", "846", "xtxsu\"", "085", "ih'fz", "5086.", "PZFVJ?", "FONO", "jkty", "87.", "ppphcm", "loycrz", "6905", "ivkhvqqfnw!", "097.6", "mfsvhtp", "\"KIIQFE?", "2.", "awtumvaf", "OOVRU", "Mnog?", "Hkggcvr!", "tobh)", "weitgm", "hdtieyef)", "0765", "FOINGTD", "jnjc", "eoadb", "(ngzexz", "dstbsrso)", "AKEKFURTO", "umne", ".19,", "euxea", "570", "(rkmtqot", "ztty", "iupwkia\"", "(Lhizdn", "ohsbqvj,", "6", "FQGISN", "4.2", "OWJK", "09", "KPOZDZ,", "48980", "9485.", "bray", "TKHG).", "snco)", "fdhccs", "Hxcw", "49", "UZTNZD", "cnuk", "Nhty.", "itpm", "szvr", "38.", "Pifk", ".2", "53.)", "eorsem)", ".8'", "(\"2792.4", "rao", "7.0'.", "EZBJHGK?", "29496", "6248", "totxgark", "(Rgwtp", "zvwad!", "Ailrax", "MNUNCPI", "CUG", "shxiact", "smn", "(fxrir", "86", "zrltrt", "hpail?", "f'yfsr", "ICTNVW", "jrnzy", "(OMLXOITA", "35601.?", "374.8", "FAQED", "8", "\"qaw", "itiid", "012.84", "Vbscjjldl", "tcmm", "Itnxd", "yutbm", "Navro", "ndum", "Hgsv", "02918.", "RNIJ", "SZYXHYLRGN", "Toakpkp", "GQEILTXQAI!", "VNICPJ", "(093!", "tozq", "eism'", "hkgea", "39888\"", "canei.", "sezip?", "vnpwqf", "777.)?", "NBK", "'ektxe,", "10.3)", "thfz,", "xpfdi", "jmft", "osfvbhsmc", "F'BWQ", "oiujpz", "5591", "ephw", "auaz,", "748", "DGW?", "mls't", "VCVMF", "\"Naexrn", "(ocme", "'kudshf", "317", "988.", "umbg", "WJISC", "RHQAC", ".6", "OZHTR", "618.", "\"6", "\"pkbjuxcf", "96", "hmy", "eqnvfdrfi", "pztr", "\"Qnodvnw)", "VJMWJI", "4402)", "zsogof", "mvpyiv", "qprattnai", "73.01", "auyntqi", "5!", "oyel", "SURBM", "1", "uonb", "gsevnsep,", "Vywxaaop)", "Rfit", "betqtste", "CDLZHH,", "74", "CBTI", "qgap", "hlii'", "'KUASDSB", "90.", "\"IHTCBFD!", "YKET?", "hmkn", "rvavp", "uaxsht", "31741", "hzboruwiw", "FDVR", "Ggprva", "qdt", "XGSSWOPA", "zdls!", "vsrp)", "uurmuo\"", "MYGCRJPV", "(BDIN", "Wgz", "Sppb", "Aqoxnnvt", "vqesjz)", "eidsb", "OCBZ", "cppwz", "snn", "EAEI,", "QGP'N", "678.48", "7142!", "wcfqi", "fid!", "17130", "ROYX", "csxvdqco", "Hdgstli", "oyek", "(royo?", "2070", "EEH", "kewk", "Sodns", "Ype", "eyuin", "vouu", "17.354)", "vmkufz", "dnerq", "Hveogxf", "321.", "FSRLV", "waripuzqd", "gmnuyhzn", "Peu", "zfik.", "kkubhnz", "1.43", "88", "642", "cosewi?", "kdh", ".06", "OAIQL", "Wgqlhqs", "Nrinqaoth", "9748?", "udslciqxss", "1", "JOGW", "953", "0\"", "vcdjua)?", "Zaagzeb)", "dlskfx)", "nikrapils", "ejdx", "Qrn", "9689.", "VETWGF", "sbx,", "DGC).", "opqyzi", "kzhrs\"!", "LSHQI", "teenrras", "4190", "nmrgc", "AQMA", "ddnrhr", "Fisefvl!", "86", "xtcldoe", "PDGILOH\"", "hpoajucxbd", "ojkxlol", "IWUCE", "\"THEP", "(8080", "ljtteqr", "Snwxeyk", "wmnyd", ".20", "81)!", "96", "ttav", "eovx.", "1377", "JZKTC,", "Uiwyqht!", "hiafvj?", "SYYXMZU", "ohgy", "olgw", "9", "20", "'1", "55929.", "sgidrynb", "hz'in", "(Aasw", "vhdfq,", "rwdk.", "\"fpqskmmk", "yzew", "ebjiombrdv", "rqnr", "AIQOIEN", "Mrjnawr", "(WBOSI", "18666", "gchr", "sweu", "firr", "77", "RETGH", "yzcoc", "hirsx,", "qumlbachfj", "(ggthbg!", "'layijd", "Nvmmjaq", "40.2.", "Eofe", "'732", "xrtahvwia)", "lfaegh", "mrbnz", "2\",", "mcfjnh)", "tebs", "Fegeryb", "1024.1!", "kdeaece", "Postymne", "vyclr)", "nqud", "(rx'tsp", "(ofghvh", "1!", "QRCNMCR.", "tscahiel", "Rvynx", "krmyyjzgv", "LTTI", "Mxiqfoehhs", "7874", "THWNC?", "ASUHP)", "Awxnp", "48,", "1.53", "\"hef", "bgizvnf?", "Xahamiyb\"", "taeo", "huhxwkm", "rwgf'v!", "80", "DVPK", "MOQN", "udbbxku", "kpcwc", "63196", "LTWC", "kmj", "Fr'ax", "Ohnay", "\"qsqpo", "lvjs'lil", "506.", "(FOCSS", "dhxelhws", "gshch", "(Dsdus!", "NAZXXTQS", "mhgfpbtv", "Wtzngebad", "xcoaiwmq", "GWHU", "nkve", "7", "Qqov.", "Jrgovwd,", "cgz", "Neryaoo", "sia", "nsgrkdas", "\"Wyueen", "NHCOQKH!", ".43268", "lem", "vogl'c", "UMRLDLSRTL", "Zvosnx!", "\"Mkmm", "Tqucawa", "\".2", "85263!", "Pasibdnn", "33995", "Ksgh)", "84.0", "npetabtr", "uzaukkwt", "WMIDL)?", "UNIZFRG", "dbshlhdn", "97156", "umtdfpyt", ".25", "gizbxzc", "ewzt", "pbdqj.", "LGSD", "Liyer", "Udcstx", ".47689", "0)", "yuifsh',", "457", "Ufkynetq)", "(tinp'ng", "04.31", "hqunj", "SJAOF", "4.", "trvror", "f'yc?", "TEWDGU,", "iid", "xushq", "OHYRM)", "rxtn", "(5480", "50", "'xtnbrgkip", "\"WFKLDR.", "BSZXOA", "tyn", "088", "5", "ZCRRZSP", "889", "OFB", "MOSDHMKNRQ", "chhng", "86)", "LIXEY", "(buwkc", "wqgwatf", "oxgabpayd?", "TWBZ", "WWCRIOZ", "Eztf", "Viooh", "BOAR)", "qrpkexc", "(\"RASQSJQQ", "TAAXU", "37.", "xbdv", "vfyc", "(Kjyhxazad.", "19", "\"Nhnbfq", "mkyj", "Sitl", "srranrppgw", "7", "2003)", "rdhqfn", "RXDW", "XFESOYG", "Zsmg", "Qadk.", "esrqr", "hjat", "\"113", "DHDFSMABT", "kkqduat", "(qexxnvd", "7549.", "Hhxfymnk", "IRADHGO", "MYHDXL", "vxoxxt,", "Xexs", "hidirdgqlt", "cpcg", "Yngh", "4060,", "nzo", "9739", "SJXO", "dydblynbnh", "7", "xycprzlanu", "idrwithp!", "Wtsbv", "(XTIGMRU", "Jwjj'", "0228", "MTEX", "HANQA", "eepaay", ".4\"", "VLHSRH\"", "0", "iruj", "IGMS", "zacpipc", "ieyc", "42532.", "(79772", "Zeybfweog", "TAZUYC", "Tlvyudeko", "efhgb.", "3891", "nnf", "djq?", "gqpixhe", "HBOR", ".91", "FRL", ".8590", "Nsegtwu", "(OQW", "7414!", "Bvzac", "(760", "cwvlfydom", "tpopv", "Rpzi", "aau'", "(UZTQBEO", "KBSMSR", "1.54", "afwa!", "fstm", "uvofo", "Wozlutxjo", "xonijftzc", "TTCUCBH", "363", "HDIPOKFXBE", "WKSZOSYDHY.", "FDOE", "\"28", "SBIXNNK", "ucpx", "IEBKRZBZ", "NVN", "VCDTNIIDFX", "IEWPJLN", "Skdtnaao", "kakkfonn", "47", "0177", "Uiqah", "ckrfz", "XRI", "san'oh", "3876.7", "faava,", "MNPB", "17'", "84", "upt", "dvems.", "QHPRWF", "09.565)", "kmazhng'", "VEFAO", "xsgbl", "53", "dmaxre", "Cvoodwh", "qdvduubjo", "pewvcvnkx", "'4.848", "1164.3", "\"enecf", "eixahirf?", "Zfqxia", "hiekf", "TNHKNE", "cflmvszf", "gogeac", "Tafp?", "Essxzo", "ODKJOD", "UUNJ", "TWLIS", "Rpaa", "LTIZ", "torv!", "04", "800", "Hllcxh", "qhkg", "BGGTNL", "ctax)", "Eunmt", "v'tjr", "cypeis", "16777.)", "wdaab", "iudx.", "wkebjzp?", "57", "xaxngm", "bwuh", "jksxrk", "airi", "Anoj", "XNER", "Blvnxif", "FISNIO\"", "yoib)", "oxesqu)", "00027", "Pusu", "72", "btrutaanyj?", "HNX", "ZPKEOQ)", "livnuk", "cpacjg", "8", "QDCZH", "Wphr", "nvkn", "3", "Xvjy", "EMQILAV", "\"xei", "urbb", "5486.0", "(\"Ihfw", "'agvbg", "xnt", "Nuio", "wvldiflbce", "25180", "Sjlyol)", "041!", "jlrcii", "Ejbnff", "Dxz", "lezig", "hsbyle", "awqm", "rioa", "ynfmp", "KMUDPBQ", "10.", "3.981", "PWMAJLK", "Hpocxt!", ".17", "dbtxrrnmk)", "Cocrjaya.", "513..", "OHZKDNPO", "oaum", "vougiej", "wtdakbmori", "66", "(jpos", "SVQMENKC'", "00", "\"osvcvmu", "vnrie", "Astbq.", "arjh", "pnqpbrmu", "219", "atwe", "\"giuridk", "EOY'MX)", "vjqc", "OYBCO", "09", "lsl", "4", "(1760.", "uee", "22382", "2", "49,", "SDUFK", "rtxchpw", "24012", "85.", "FTP", "dpbwt", "DBAP", "vrreglwdn", "893", "xuwh", "dtvgs", "pvjt", "vkupwl", "Addgkmt'", "LOPMEB.", "18.42", "idhvmtr,", "QJHYCS", "zeelqrnh", "VMMHBU?", "214.6", "LPN", "QVCN", "dgprd", "gzz", "724", "rjgsw,", "hwrotjv", "YEO", "qklsf\"", "97", "92291)", ".6", "SOPYHC!", "Nredccn", "Lplsrn", "Rtfm", "6", "60", "(QGATM", "gevrilxa", "BSMQIZFGW)", "168.56)", "(ckgoe", "gzosub", "DMS)", "ibqe", "Gwgqwh.", "Wxh", "BOXUHKCWX", "kmdr", "Ouyhi", "82", "(5", "miwq", "855", "ysemjz", "5421.", "azcqn", "(jaseybq", "SFIQ", "FUAA\",", "uxiela", "Qqfcx", "ekka", "edykhc", "vqvqi)", "hevdy", "YOYT", "JEEAAM", "vtzv", "odvnv", "86271.", "Tx'vtr", "52", "escdi", "Hieuntd", "xtr'be", "aoqnkugetr", "YYH", "mveyvc?", "36", "Ikgxtpa", "nenchye", "lcpak", "07.", "edlrtasbi,", "Msqe,", "OZOASQ", "9.\"", "ekwnred.", "Tx'e?", "NSHGURO", "Tfpgfld", "'60", "575", "fbzen", "bjrvblkfb", "\"djs", "rek", "81", "aipojee", "6132", "Qrll", "rkox.", "UWSTLIZS", "Hlkcj", "(BLDVPFAI", "SRYQ", "YEEGAZL).", "Tvjrk'", "77.62", "kyxmaiv", "dmjh'", "plid", "eryphrl", "VVNX!", "axsy", "eyrhqsq", "2394.", "ezugns", "89425)", "aml'czazgtl", "tyra", "131,", "Nkerr", "JMTM", "482'0", "'lni", "yazkrm", "1)", "3", "ueinltwre", "(knlcb", "eteas", "'83894).", "dnum\"", "7.)", "Kuvvc", "wvki", "3.344", "Inaou,", "FFOZ", "DNTTQ", "Cvfjlp", "ndsocya!", "933.6", "(ibrmgo", "dsrs!", "evtiobnh", ".9531", "ggra", "onsz", "Vsrc?", "ucr?", "icvit", "THWOA", "UIBK", "nzs", "3.061)", "Latiu", "nlos", "4.8", "GZII", "sblwuqjrex", "sfx", "3977.?", "6)?", "sizeqvx", "\"hjet", "csj", "isepea", "17'.", "331", "Odcnajanp", "86!", "(yfwbglo", "6143.5)", "PLBS", "(welniz", "tzqu", "KEY?", "1.", "(07.", "BEMHH", "phfxvawuai?", "snexsv", "arjway'.", "SSDQVNNA", "51841", "ltx", "(Mlpn", "wtakphu!", "bdx!", "fgtju", "HNYINCBG", "entc'.", "944", "NEIG", "260\"", "9119", "zhseaaiiir", "\"faulwepnka", "(.7", "Qsfe", "eswx", "588.", "9)", "riybbtdtq", "RVHX", "SYIA", "NECSUCA", "NTTIZNEG", "YECW", "Aosaoznu)", "XRCF", "ptrlzwer", "hnblrbs", "Tbbhv", "Nlrogm", "HLVMDZ", "ahxu", "40.", "Isbpqyez", "jjybtqid", "emjwpy", "xttxjn", "\"00971", "ajtnlgvah", "JALIPJ", "6204.", "37601,", "dliflqy", "5624.).", "wyn", "htmjds", "FDTRKSIIO", "IURT", ".59", "zcosmo", "28133?", "19.1", "kokna", "tyiitwz", "ivhns", "2,", "LOOYHFQ", "sphn", "(095", "bwraiv", "8115", "IZHSO", "GIVJKRAW", "wrtxibq", "uzoe", "mxudrjyu", "nmobf", "zighflxoi", "8.0'", "aafi", "BPVCTJR!", "exizad", "KAJGLT", "Bcwuzpet", "\"czhj", "aqwlti", "rpqhvnnug", "tdhbcp,", "iijum", "JTHSB", "583!", "gfaw", "pwn,", "tyfsuh", "VJOSECY", "ioys", "(0248?", "Rh'qniglgm", "Otoh", "knmdg", ".2658", "Ahpv", "(gmewtmbe", "clqt", "Udx", "0.", "1383.2'", "cqss", "SBZRBE", "EMCFEOK", "tkcjhw", "M'pkfpoz", "bnio\"", "(Orffisac", "ANAX", "\"uvozv", "knxf", "Cdbe", "aszqs", "kctikqrig\"", "Aoblbpha\"", "NHDC", "werh", "0.993", "(NNB.", "ielbahces", "\"cneicpcn", ".5", "13326!", "fhkvktdz", "6236", "(989", "ysdzl", "ssoa?", "0.4", "065", "msypzdvn", "\"Wdnybblih", "4.4,", "fkxyieusg!", "LTQSKABTM", "msfbefvxo?", "YGSPAIIIA", "434", "75", "pliqe", ".16\"", "Qiuv", "ryzn'p)", "eim", "HSUOP!", ".8", "OXVGZI", "rgpln", "'apehj)", "YOPXKHZN", "jlk", "Rbioienx", "xhk", "omq", "semyg", "reacr", "(INLLIK", "ANJVAS", "UMLS", "ykuo", "TGYKKGL)", "Xyrbwhea", "2'20", "Edr", "5", "dirn?", "\"5", "88", "bkvr", "Jhsbgb", "Qobf,", "xfh", "hhsr", "apwnayl", "OUIENAL", "qgelxps", "RTTEKUZPI", ".108", "mtdo", "LMVMD", "cbjy", "dzitqohal,", "hkeo", "CTYKAUTH", "zdmaovders", "itsqjsihi)", "4.6601", "hemaz", "cecxcupk", "7.783", "SHFKWF", "tedaak?", "9", "poizo\"", "Lcotajqe", "Widb", "jguh", "6)", "jpkh", "cihvypoyc)", "BYOCHRTJA", "887", "Esb,", "Xdltiq", "2.", "(tofl", "OSD", "nniimcs", "0.", "opnwsuec", "oaennazov?", "umbgjngg", "Kmxjat!", "ERO.", "uotofths", "Qojjx", "YKCDU", "EXTZAJEZ", "bxjvao?", "235'4", "'ALPYGV", "rczlu", "UXC!", "ogootmenkb)", "(LIISKFNO", "pimdgt", "hkik", "Bamnuhy", "NZZDM", "nv'onhe", "QOBY", "8340", "horutl", "3967", "5219", "MVIV", "luian", "fudn", "37522", "xxastappi", "zeyqpakdrs", "oihg", "Imujo", "861.", "1319", "Hodi", "vg'j", "hrxfi", "gatqnbnp", "Wancwt", "elde", "431?", "qesaa", "(rrih", "utu,", "ziaeakwq", "erhxeen", "6.0", "lfkdhea", "3.", "ksooxe", "1723\"", "41809", "hbf!", "syvr'", "UTNTHN", "zayirnbhha", "(3!", "evlz", "(4216.", "ngs", "ugbqguy", "710", "93961", "98.871,", "8)", "AATN", "(ZYJPRI", "fexyjiosz),", "Tcvv", ".62259", "YXQK", "shvauf.", "96", "mzsb", "QEABEONSKX)?", "Bdyf", "8571", "rtzheysis", "kupc?", "ysen", "KXBTP", "gskaxuxy", "BXIBVFHO,", "'upkbmmbcnp", "(oaddzn", "6", "cocys", "AARHRBEHJ", "UDPBIAOQ", "Jtezodo", "digw\"", "BYHAA", "WQMUQAWA", "YASSO?", "Cnwxxognea", "sxijvttu", "VPW", "Gkkebvac", "OUIJAUPBQ", "6560", "GCJWVI", "nnoe", "73576", "ISDPLBYGDT", "7264", "FREX!", "Nvdchfu", "gumdk)", "kev", "550", "pyayptdl", "(gzcnpsg", "wzdsdn", "PWWTZ", "jrct)", "ryuexuou", "tumq", "MCMY", "Yeovuu", "5\"", ".92521)", "efhwj,", "HSRLR\",", "pnfg", "ZILHJQ", "Ewnaxct", ".71", "ZFHES", ".477.", "BJPRI", "ZOXEJLW", "0.4", "kjrcj?", "0", "clhi", "BIRLDII", "iisixd", "yhlokqjwkw)", "9.", "rlw'btyox", "IALETMN", "\"NSRALUC)", "nbra.", "4", "Afj", "IHS", "siuidxkixu\")", "\"yxswx", "TDUT", ".44", "(56937.?", "7", "Iutuf)", "J'CIS", "\"reik", "ypshv", "\"POIN", "(Vcanbvxw", "(YHPRQ", "20", "rluw", "6", "83441", "Mgdg", "31843", "sequkdets", "2100", "HQQEI", "lkcq)", "lidjxj", "42509", "rtbsxb", "(Eaqazoyrt", "Oebu", "NIUT", "xlzotmd", "BHFOLNH", "\"NFE", "vbidhuz", "nce", "lfntqpxx.", "LONW)"];
                setWordBank(words);
            };

            const generatePrompt = () => {
                if (wordBank.length === 0) return;

                    let prompt;
                    if (samplingMode === 'random') {
                        prompt = Array(wordCount).fill().map(() => wordBank[Math.floor(Math.random() * wordBank.length)]).join(' ');
                        setCurrentPrompt(prompt);
                    } else {
                        prompt = Array(wordCount).fill().map(() => {
                            const word = wordBank[currentIndex];
                            
                            setCurrentIndex((prevIndex) => {
                                const newIndex = (prevIndex + 1) % wordBank.length;
                                setDisplayIndex(newIndex);
                                return newIndex;
                            });

                            return word;
                        }).join(' ');
                        setCurrentPrompt(prompt);
                    }
                    if (samplingMode === 'random') {
                        setCurrentPrompt(prompt);
                    }
                setAsciiSequence(prompt); // Populate ASCII box with the prompt
            };

            React.useEffect(() => {
                loadWordBank();
            }, []);

            React.useEffect(() => {
                if (samplingMode === 'random') {
                    generatePrompt();
                } else if (wordBank.length > 0) {
                // For ordered mode, generate prompt once when wordBank is loaded
                    generatePrompt();
                }
            }, [samplingMode, wordCount, wordBank]);


            return (
                <div className="container">
                    <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '16px' }}>Handwriting Stroke Capture</h2>
                    <p style={{ fontSize: '14px', color: '#4B5563', marginBottom: '16px' }}>
                        Instructions: Upload an image, trace the writing, enter author and ASCII sequence, then add to dataset. Export when finished.
                    </p>
                    {errorMessage && <ErrorMessage message={errorMessage} />}
                    <Input
                        type="file"
                        accept="image/*"
                        onChange={handleImageUpload}
                        style={{ marginBottom: '16px' }}
                    />
                    <div style={{ marginBottom: '16px' }}>
                        <Label htmlFor="word-count">Number of Words in Prompt</Label>
                        <Input
                            id="word-count"
                            type="number"
                            min="1"
                            max="10"
                            value={wordCount}
                            onChange={(e) => {
                                const newWordCount = parseInt(e.target.value);
                                setWordCount(newWordCount);
                                 // Generate a new prompt only for random mode
                                 // or if it's the initial load for ordered mode
                                setTimeout(() => generatePrompt(), 0);
                            }}
                        />
                    </div>
                    {currentPrompt && (
                        <div style={{ 
                            marginBottom: '16px'
                        }}>
                            {currentPrompt}
                        </div>
                    )}
                    <canvas
                        ref={canvasRef}
                        width={1200}
                        height={200}
                        onMouseDown={startDrawing}
                        onMouseMove={draw}
                        onMouseUp={endDrawing}
                        onMouseOut={endDrawing}
                        style={{ border: '1px solid #CBD5E0', cursor: 'crosshair', marginBottom: '16px', maxWidth: '100%' }}
                    />

                    <div style={{ marginBottom: '16px' }}>
                        <Label htmlFor="sampling-mode">Sampling Mode</Label>
                        <div style={{ display: 'flex', alignItems: 'center' }}>
                            <Input
                                id="sampling-mode"
                                type="checkbox"
                                checked={samplingMode === 'ordered'}
                                onChange={(e) => {
                                    setSamplingMode(e.target.checked ? 'ordered' : 'random');
                                    setCurrentIndex(startIndex);
                                }}

                                style={{ marginRight: '8px' }}
                            />
                            <span>Ordered</span>
                        </div>
                    </div>
                    {samplingMode === 'ordered' && (
                        <div style={{ marginBottom: '16px' }}>
                            
                            <Label htmlFor="start-index" style={{ marginRight: '8px' }}>
                            {`Word Bank Index (current: ${displayIndex}/${wordBank.length})`}
                            </Label>
                            <Input
                                id="start-index"
                                type="number"
                                min="1"
                                max={wordBank.length}
                                value={startIndex+1}
                                onChange={(e) => {
                                    const newIndex = Math.max(0, Math.min(parseInt(e.target.value) - 1, wordBank.length - 1));
                                    setStartIndex(newIndex);
                                    setCurrentIndex(newIndex);
                                    setDisplayIndex(newIndex);
                                }}

                            />
                        </div>
                    )}

                    <div style={{ marginBottom: '16px' }}>
                        <p style={{ fontSize: '14px', color: '#4B5563', marginBottom: '8px' }}>Image Positioning Controls:</p>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '8px', marginBottom: '8px' }}>
                            <Button onClick={() => handleImageMove('up')}>↑</Button>
                            <Button onClick={() => handleImageMove('down')}>↓</Button>
                            <Button onClick={() => handleImageMove('left')}>←</Button>
                            <Button onClick={() => handleImageMove('right')}>→</Button>
                        </div>
                        <div>
                            <Label htmlFor="scale-slider">Image Scale</Label>
                            <Slider
                                id="scale-slider"
                                min={0.1}
                                max={2}
                                step={0.1}
                                value={imageScale}
                                onChange={(e) => setImageScale(parseFloat(e.target.value))}
                            />
                        </div>
                    </div>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '16px' }}>
                        <div>
                            <Label htmlFor="author-input">Author</Label>
                            <Input
                                id="author-input"
                                value={author}
                                onChange={(e) => setAuthor(e.target.value)}
                                placeholder="Enter author name"
                            />
                        </div>
                        <div>
                            <Label htmlFor="ascii-input">ASCII Sequence</Label>
                            <Input
                                id="ascii-input"
                                value={asciiSequence}
                                onChange={(e) => setAsciiSequence(e.target.value)}
                                placeholder="Enter ASCII sequence"
                            />
                        </div>
                    </div>
                    

                    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', marginBottom: '16px' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <Button onClick={() => { clearAll(); }}>Clear All</Button>
                            <Button onClick={undo}>Undo</Button>
                            {samplingMode === 'ordered' && (
                                <Button onClick={generatePrompt}>Next Word</Button>
                            )}
                            <Button onClick={() => {
                                const success = addToDataset();
                                if (success && samplingMode === 'ordered') {
                                    setDisplayIndex((currentIndex + 1) % wordBank.length);
                                    generatePrompt();
                                } else if (success && samplingMode === 'random') {
                                    generatePrompt();
                                }
                            }}>Add to Dataset</Button>
                        </div>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <Button onClick={exportDataset}>Export Dataset</Button>
                            <span style={{ fontSize: '14px', color: '#4B5563' }}>
                                Dataset size: {dataset.length} entries
                            </span>
                        </div>
                    </div>



                    {exportedData && (
                        <Textarea
                            value={exportedData}
                            readOnly
                            placeholder="Exported dataset will appear here"
                        />
                    )}
                </div>
            );
        };

        ReactDOM.render(<HandwritingStrokeCapture />, document.getElementById('root'));
    </script>
</body>
</html>